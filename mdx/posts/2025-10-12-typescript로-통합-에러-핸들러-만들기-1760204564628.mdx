---
title: "TypeScriptë¡œ í†µí•© ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë§Œë“¤ê¸°"
date: 2025-10-12 02:42
category: "ì‚¬ì´ë“œ í”„ë¡œì íŠ¸"
tags: ["Typescript", "íƒ€ì…ê°€ë“œ", "ì—ëŸ¬ í•¸ë“¤ëŸ¬"]
thumbnail: "https://raw.githubusercontent.com/ParkYongHo1/ParkYongHo.blog/main/mdx/images/1760204564627-82cbed39-d62a-4ab9-9e82-76830ba9f52b.png"
readingTime: "9ë¶„"
---

## ë¬¸ì œ ìƒí™©

Next.js API ë¼ìš°íŠ¸ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•˜ë‹¤ ë³´ë©´ catch ë¸”ë¡ì´ ì ì  ê¸¸ì–´ì§„ë‹¤.

```
export async function POST(request: NextRequest) {
  try {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§...
  } catch (error) {
    console.error(error);

    // GitHub API ì—ëŸ¬
    if (axios.isAxiosError(error)) {
      const status = error.response?.status;
      const message = error.response?.data?.message;

      if (status === 400) {
        return NextResponse.json({ error: "ì˜ëª»ëœ ìš”ì²­" }, { status: 400 });
      }
      if (status === 401) {
        return NextResponse.json({ error: "ì¸ì¦ ì‹¤íŒ¨" }, { status: 401 });
      }
      if (status === 429) {
        return NextResponse.json({ error: "ìš”ì²­ í•œë„ ì´ˆê³¼" }, { status: 429 });
      }
      return NextResponse.json({ error: message }, { status: status || 500 });
    }

    // í™˜ê²½ ê²€ì¦ ì—ëŸ¬
    if (error.message.includes("production")) {
      return NextResponse.json({ error: error.message }, { status: 403 });
    }

    // GitHub ì„¤ì • ì—ëŸ¬
    if (error.message.includes("GitHub")) {
      return NextResponse.json({ error: error.message }, { status: 500 });
    }

    // ì¼ë°˜ ì—ëŸ¬
    return NextResponse.json({ error: "ì„œë²„ ì˜¤ë¥˜" }, { status: 500 });
  }
}
```

**ë¬¸ì œì :**
- catch ë¸”ë¡ì´ ë„ˆë¬´ ê¸¸ì–´ì§ (20ì¤„ ì´ìƒ)
- ìƒíƒœ ì½”ë“œ(400, 401, 403, 429, 500)ê°€ ì—¬ê¸°ì €ê¸° í©ì–´ì ¸ ìˆìŒ
- ì—ëŸ¬ ë©”ì‹œì§€ë¡œ íƒ€ì…ì„ êµ¬ë¶„í•˜ëŠ” ê±´ ë„ˆë¬´ ë¶ˆì•ˆì •í•¨
- ë‹¤ë¥¸ API ë¼ìš°íŠ¸ì—ì„œ ë˜‘ê°™ì€ ì½”ë“œë¥¼ ë˜ ì‘ì„±í•´ì•¼ í•¨

## í•´ê²° ë°©ë²•: í†µí•© ì—ëŸ¬ í•¸ë“¤ëŸ¬

ëª¨ë“  ì—ëŸ¬ë¥¼ í•œ ê³³ì—ì„œ ì²˜ë¦¬í•˜ëŠ” í†µí•© í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“¤ë©´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

### 1ë‹¨ê³„: ì»¤ìŠ¤í…€ ì—ëŸ¬ íƒ€ì… ë§Œë“¤ê¸°

ë¨¼ì € ìƒíƒœ ì½”ë“œë¥¼ í¬í•¨í•˜ëŠ” ì—ëŸ¬ íƒ€ì…ì´ í•„ìš”í•˜ë‹¤.

```
// lib/errors/apiError.ts

export interface ApiErrorType extends Error {
  statusCode: number;
  isApiError: true;  // ì‹ë³„ì
}

export const createApiError = (
  message: string,
  statusCode: number = 500
): ApiErrorType => {
  const error = new Error(message) as ApiErrorType;
  error.statusCode = statusCode;
  error.isApiError = true;
  return error;
};
```

ì‚¬ìš©ë²•:

```
throw createApiError("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.", 403);
throw createApiError("GitHub ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", 500);
```

### 2ë‹¨ê³„: íƒ€ì… ê°€ë“œ ì¶”ê°€

í†µí•© í•¸ë“¤ëŸ¬ì—ì„œ ì—ëŸ¬ íƒ€ì…ì„ êµ¬ë¶„í•˜ë ¤ë©´ íƒ€ì… ê°€ë“œê°€ í•„ìš”í•˜ë‹¤.

**íƒ€ì… ê°€ë“œë€?** ëŸ°íƒ€ì„ì— íƒ€ì…ì„ í™•ì¸í•˜ê³ , TypeScriptì—ê²Œ "ì´ ë³€ìˆ˜ëŠ” ì´ íƒ€ì…ì´ ë§ë‹¤"ê³  ì•Œë ¤ì£¼ëŠ” í•¨ìˆ˜ë‹¤.

```
export const isApiError = (error: unknown): error is ApiErrorType => {
  //                                        â†‘ íƒ€ì… ê°€ë“œ ë¬¸ë²•
  return (
    typeof error === "object" &&
    error !== null &&
    "isApiError" in error &&
    (error as ApiErrorType).isApiError === true
  );
};
```

#### íƒ€ì… ê°€ë“œì˜ íš¨ê³¼

íƒ€ì… ê°€ë“œê°€ ì—†ìœ¼ë©´:

```
const handleError = (error: unknown) => {
  console.log(error.statusCode);  // âŒ ì—ëŸ¬! unknown íƒ€ì…ì—ëŠ” statusCode ì—†ìŒ
};
```

íƒ€ì… ê°€ë“œê°€ ìˆìœ¼ë©´:

```
const handleError = (error: unknown) => {
  if (isApiError(error)) {
    console.log(error.statusCode);  // âœ… ì ‘ê·¼ ê°€ëŠ¥!
    console.log(error.message);     // âœ… ì ‘ê·¼ ê°€ëŠ¥!
  }
};
```

#### null ì²´í¬ê°€ í•„ìš”í•œ ì´ìœ 

JavaScriptì—ëŠ” ìœ ëª…í•œ ë²„ê·¸ê°€ ìˆë‹¤.

```
typeof null === "object"  // true! ğŸ˜±
```

ê·¸ë˜ì„œ `error !== null` ì²´í¬ë¥¼ ë¹¼ë¨¹ìœ¼ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

```
// âŒ null ì²´í¬ ì—†ìœ¼ë©´
export const isApiError = (error: unknown): error is ApiErrorType => {
  return (
    typeof error === "object" &&  // nullë„ í†µê³¼!
    "isApiError" in error  // ğŸ’¥ TypeError! nullì—ëŠ” ì†ì„±ì´ ì—†ìŒ
  );
};

// âœ… null ì²´í¬ í•„ìˆ˜
export const isApiError = (error: unknown): error is ApiErrorType => {
  return (
    typeof error === "object" &&
    error !== null &&  // null ì œì™¸
    "isApiError" in error &&
    (error as ApiErrorType).isApiError === true
  );
};
```

### 3ë‹¨ê³„: í†µí•© ì—ëŸ¬ í•¸ë“¤ëŸ¬ êµ¬í˜„

ì´ì œ ëª¨ë“  ê±¸ í•©ì³ì„œ í†µí•© í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“ ë‹¤.

```
// lib/api/errorHandler.ts
import { NextResponse } from "next/server";
import axios from "axios";
import { isApiError } from "@/lib/errors/apiError";

export const handleApiError = (error: unknown) => {
  console.error("API ë¼ìš°íŠ¸ ì˜¤ë¥˜:", error);

  // 1. ì»¤ìŠ¤í…€ ì—ëŸ¬
  if (isApiError(error)) {
    return NextResponse.json(
      { error: error.message },
      { status: error.statusCode }
    );
  }

  // 2. Axios ì—ëŸ¬
  if (axios.isAxiosError(error)) {
    const status = error.response?.status || 500;
    const message = error.response?.data?.message || "API ì˜¤ë¥˜";
    return NextResponse.json({ error: message }, { status });
  }

  // 3. ì¼ë°˜ Error
  if (error instanceof Error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }

  // 4. ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬
  return NextResponse.json(
    { error: "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
    { status: 500 }
  );
};
```

## ê²°ê³¼: ê¹”ë”í•œ API ë¼ìš°íŠ¸

ì´ì œ catch ë¸”ë¡ì´ í•œ ì¤„ë¡œ ì¤„ì–´ë“ ë‹¤.

### Before (20ì¤„)

```
export async function POST(request: NextRequest) {
  try {
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§...
  } catch (error) {
    console.error(error);

    if (axios.isAxiosError(error)) {
      const status = error.response?.status;
      const message = error.response?.data?.message;
      if (status === 400) {
        return NextResponse.json({ error: "ì˜ëª»ëœ ìš”ì²­" }, { status: 400 });
      }
      if (status === 401) {
        return NextResponse.json({ error: "ì¸ì¦ ì‹¤íŒ¨" }, { status: 401 });
      }
      if (status === 429) {
        return NextResponse.json({ error: "ìš”ì²­ í•œë„ ì´ˆê³¼" }, { status: 429 });
      }
      return NextResponse.json({ error: message }, { status: status || 500 });
    }

    if (error.message.includes("production")) {
      return NextResponse.json({ error: error.message }, { status: 403 });
    }

    return NextResponse.json({ error: "ì„œë²„ ì˜¤ë¥˜" }, { status: 500 });
  }
}
```

### After (1ì¤„)

```
import { createApiError } from "@/lib/errors/apiError";
import { handleApiError } from "@/lib/api/errorHandler";

export async function POST(request: NextRequest) {
  try {
    if (process.env.NODE_ENV === "production") {
      throw createApiError("ê¸€ ì‘ì„±ì€ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.", 403);
    }

    const config = validateEnvironment();
    if (!config) {
      throw createApiError("GitHub ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", 500);
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§...

    return NextResponse.json({ success: true });
  } catch (error) {
    return handleApiError(error);  // âœ¨ í•œ ì¤„!
  }
}
```

## íƒ€ì… ê°€ë“œì˜ ë™ì‘ ì›ë¦¬

ê° ì¡°ê±´ì´ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

```
export const isApiError = (error: unknown): error is ApiErrorType => {
  return (
    // 1ë‹¨ê³„: ê°ì²´ì¸ì§€ í™•ì¸ (ë©”ì‹œì§€, ìƒíƒœ ì½”ë“œë¥¼ ë‹´ëŠ” ê°ì²´)
    typeof error === "object" &&
    
    // 2ë‹¨ê³„: null ì œì™¸ (typeof null === "object"ì´ë¯€ë¡œ í•„ìˆ˜)
    error !== null &&
    
    // 3ë‹¨ê³„: ì‹ë³„ìê°€ ìˆëŠ”ì§€ í™•ì¸
    "isApiError" in error &&
    
    // 4ë‹¨ê³„: ê°’ì´ trueì¸ì§€ í™•ì¸ (ì •í™•í•œ ê²€ì¦)
    (error as ApiErrorType).isApiError === true
  );
};
```

## ì¥ì 

### ì½”ë“œ í’ˆì§ˆ
- âœ… catch ë¸”ë¡ì´ í•œ ì¤„ë¡œ ë‹¨ì¶•
- âœ… ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ì´ í•œ ê³³ì— ì§‘ì¤‘
- âœ… ì¬ì‚¬ìš© ê°€ëŠ¥ (ëª¨ë“  API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©)
- âœ… í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€

### íƒ€ì… ì•ˆì „ì„±
- âœ… ëŸ°íƒ€ì„ íƒ€ì… ì²´í¬
- âœ… TypeScript íƒ€ì… ì¶”ë¡  ìë™í™”
- âœ… ìë™ì™„ì„± ì§€ì›
- âœ… ì»´íŒŒì¼ íƒ€ì„ ì—ëŸ¬ ë°©ì§€

## ë§ˆì¹˜ë©°

í†µí•© ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¥¼ ë§Œë“¤ë©´ catch ë¸”ë¡ì´ ê¹”ë”í•´ì§€ê³ , ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. íƒ€ì… ê°€ë“œë¥¼ í™œìš©í•˜ë©´ ëŸ°íƒ€ì„ ì•ˆì „ì„±ë„ í™•ë³´í•  ìˆ˜ ìˆë‹¤.

---

## ì „ì²´ ì½”ë“œ

### lib/errors/apiError.ts
```
export interface ApiErrorType extends Error {
  statusCode: number;
  isApiError: true;
}

export const createApiError = (
  message: string,
  statusCode: number = 500
): ApiErrorType => {
  const error = new Error(message) as ApiErrorType;
  error.statusCode = statusCode;
  error.isApiError = true;
  return error;
};

export const isApiError = (error: unknown): error is ApiErrorType => {
  return (
    typeof error === "object" &&
    error !== null &&
    "isApiError" in error &&
    (error as ApiErrorType).isApiError === true
  );
};
```

### lib/api/errorHandler.ts
```
import { NextResponse } from "next/server";
import axios from "axios";
import { isApiError } from "@/lib/errors/apiError";

export const handleApiError = (error: unknown) => {
  console.error("API ë¼ìš°íŠ¸ ì˜¤ë¥˜:", error);

  if (isApiError(error)) {
    return NextResponse.json(
      { error: error.message },
      { status: error.statusCode }
    );
  }

  if (axios.isAxiosError(error)) {
    const status = error.response?.status || 500;
    const message = error.response?.data?.message || "API ì˜¤ë¥˜";
    return NextResponse.json({ error: message }, { status });
  }

  if (error instanceof Error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }

  return NextResponse.json(
    { error: "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." },
    { status: 500 }
  );
};
```

### ì‚¬ìš© ì˜ˆì‹œ
```
import { createApiError } from "@/lib/errors/apiError";
import { handleApiError } from "@/lib/api/errorHandler";

export async function POST(request: NextRequest) {
  try {
    if (someCondition) {
      throw createApiError("ì—ëŸ¬ ë©”ì‹œì§€", 403);
    }
    return NextResponse.json({ success: true });
  } catch (error) {
    return handleApiError(error);
  }
}
```
